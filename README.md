# ü§ñ DC Circuit Analysis Environment

**–ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏—Ö —Ü–µ–ø–µ–π —Å reinforcement learning –∏ –ò–ò**

## üéØ –ß—Ç–æ —ç—Ç–æ?

–°–∏—Å—Ç–µ–º–∞ –¥–ª—è:
- ‚úÖ **–ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–∞–¥–∞—á** –∞–Ω–∞–ª–∏–∑–∞ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏—Ö —Ü–µ–ø–µ–π
- ‚úÖ **RL –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π** —Å GRPO –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º
- ‚úÖ **–û—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞** –æ—Ç–≤–µ—Ç–æ–≤ –º–æ–¥–µ–ª–µ–π
- ‚úÖ **–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–µ—à–µ–Ω–∏–π** —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –Ω–∞–≥—Ä–∞–¥

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
/Users/stepprog/tbank2/
‚îú‚îÄ‚îÄ base/              # –ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ data.py       # –ö–ª–∞—Å—Å—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ game.py       # –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ verifier.py   # –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤
‚îú‚îÄ‚îÄ dc_circuit/        # –Ø–¥—Ä–æ –∞–Ω–∞–ª–∏–∑–∞ —Ü–µ–ø–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ game.py       # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —Ä–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á
‚îÇ   ‚îú‚îÄ‚îÄ generator.py  # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ü–µ–ø–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ prompt.py     # –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ solver.py     # –†–µ—à–∞—Ç–µ–ª—å —Ü–µ–ø–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ verifier.py   # –í–µ—Ä–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ä–µ—à–µ–Ω–∏–π
‚îú‚îÄ‚îÄ training/          # –°–∏—Å—Ç–µ–º–∞ –æ–±—É—á–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ rl_trainer.py    # GRPO –æ–±—É—á–µ–Ω–∏–µ (–æ—Å–Ω–æ–≤–Ω–æ–π)
‚îÇ   ‚îú‚îÄ‚îÄ evaluate.py      # –û—Ü–µ–Ω–∫–∞ –º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ datasets.py      # –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ utils.py         # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ README_RL.md     # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è RL
‚îú‚îÄ‚îÄ config/            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ main.py            # –ì–ª–∞–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ requirements.txt   # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md          # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –ë–∞–∑–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# RL –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–¥–ª—è –æ–±—É—á–µ–Ω–∏—è)
pip install unsloth trl peft bitsandbytes accelerate
```

### 2. –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

```bash
python main.py
```

### 3. –î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø—Ü–∏–∏

1. **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏** - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∑–∞–¥–∞—á
2. **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤
3. **–ü—Ä–æ—Å—Ç–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è** - –±–∞–∑–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏** - CPU-based —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
5. **–°–æ–∑–¥–∞–Ω–∏–µ –¥–∞—Ç–∞—Å–µ—Ç–∞** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–±—É—á–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
6. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏
7. **RL –æ–±—É—á–µ–Ω–∏–µ** - GRPO –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
8. **–û—Ü–µ–Ω–∫–∞ –º–æ–¥–µ–ª–µ–π** - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ baseline –∏ –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏

## üé® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–¥–∞—á:**
- –°–µ—Ä–∏–∏, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∏ —Å–º–µ—à–∞–Ω–Ω—ã–µ —Ü–µ–ø–∏
- –†–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (1-10)
- –§–∏–∑–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ü–µ–ø–∏
- –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –≤–æ–ø—Ä–æ—Å–æ–≤

### **RL –æ–±—É—á–µ–Ω–∏–µ (GRPO):**
- **unsloth** –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
- **5 reward functions** –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞
- **LoRA –∞–¥–∞–ø—Ç–µ—Ä—ã** –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ fine-tuning
- **vLLM —É—Å–∫–æ—Ä–µ–Ω–∏–µ** –¥–ª—è inference
- **–ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞** –Ω–∞–≥—Ä–∞–¥ (0.0-4.5 –±–∞–ª–ª–∞)

### **–û—Ü–µ–Ω–∫–∞ –º–æ–¥–µ–ª–µ–π:**
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ baseline vs –æ–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
- –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–¥–∞—á–∏:**
```python
from dc_circuit.game import DCCircuitGame
game = DCCircuitGame()
data = game.generate(difficulty=5)
print(data.question)  # "–ù–∞–π–¥–∏—Ç–µ —Ç–æ–∫ —á–µ—Ä–µ–∑ R1..."
print(data.answer)    # "0.123"
```

### **RL –æ–±—É—á–µ–Ω–∏–µ:**
```python
from training.rl_trainer import DCCircuitRLTrainer, TrainingConfig

config = TrainingConfig(max_steps=500, lora_r=64)
trainer = DCCircuitRLTrainer(config)
trainer.train()  # –û–±—É—á–∞–µ—Ç –º–æ–¥–µ–ª—å —Å GRPO
```

### **–û—Ü–µ–Ω–∫–∞:**
```python
from training.evaluate import generate_full_report

baseline, trained = generate_full_report()
print(f"–£–ª—É—á—à–µ–Ω–∏–µ: {trained['avg'] - baseline['avg']:.2f}")
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### **–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö:**
```text
–ü—Ä–æ–º–ø—Ç: "...Question: –ù–∞–π–¥–∏—Ç–µ —Ç–æ–∫... Answer: <gold>0.123</gold>"
–û—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏: "<reasoning>–†–∞—Å—Å—É–∂–¥–∞–µ–º...</reasoning><answer>0.123</answer>"
```

### **Reward functions:**
- **XML Count** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ–≥–æ–≤
- **Format** - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **Numeric** - —á–∏—Å–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
- **Correctness** - —Ç–æ—á–Ω–æ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è

### **GPU —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- **8GB+ VRAM** –¥–ª—è 3B –º–æ–¥–µ–ª–∏
- **unsloth** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏
- **Flash Attention 2** –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–°–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:**
- üéØ **–ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ** –≤–º–µ—Å—Ç–æ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ
- üß† **–ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ñ–∏–∑–∏–∫–∏** —Ü–µ–ø–µ–π
- ‚ö° **–ë—ã—Å—Ç—Ä—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é** –∑–∞–¥–∞—á
- üìà **–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—É—é –æ—Ü–µ–Ω–∫—É** –º–æ–¥–µ–ª–µ–π

## üåê GitHub –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

**–ü–æ–ª–Ω—ã–π –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ GitHub:**
```bash
git clone https://github.com/your-username/dc-circuit-analysis.git
cd dc-circuit-analysis
```

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:**
```
/dc-circuit-analysis/
‚îú‚îÄ‚îÄ base/              # –ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã
‚îú‚îÄ‚îÄ dc_circuit/        # –Ø–¥—Ä–æ –∞–Ω–∞–ª–∏–∑–∞ —Ü–µ–ø–µ–π
‚îú‚îÄ‚îÄ training/          # –°–∏—Å—Ç–µ–º–∞ –æ–±—É—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ config/            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ main.py            # –ì–ª–∞–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ requirements.txt   # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### **–î–ª—è 2 T4 GPU:**
```bash
# –ó–∞–ø—É—Å–∫ —Å 2 GPU
python3 training/rl_trainer.py \
  --model unsloth/Qwen2.5-3B-Instruct \
  --num-gpus 2 \
  --gpu-memory-utilization 0.8 \
  --batch-size 1 \
  --max-steps 500
```

---

*–°–æ–∑–¥–∞–Ω–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ –æ–±—É—á–µ–Ω–∏—é –º–æ–¥–µ–ª–µ–π –∞–Ω–∞–ª–∏–∑–∞ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏—Ö —Ü–µ–ø–µ–π* üöÄ‚ö°üî¨
